<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>draw</title>
</head>

<body>
    <canvas id="canvas" width="800px" height="800px" style="border: 1px solid black"></canvas>
    <button onclick="flag=0">画圆</button>
    <button onclick="flag=1">画矩形</button>
    <button onclick="clearAll()">清除</button>
    <script>
        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');
        var flag = 1;
        var rect = [];
        var rectNum = 0;
        var circle = [];
        var circleNum = 0;
        canvas.onmousedown = function (e1) {
            if (flag) {
                //creat rect
                rect[rectNum] = new Rect(e1.clientX - canvas.offsetLeft, e1.clientY - canvas.offsetTop, 0, 0)
                canvas.onmousemove = function (e2) {
                    ctx.clearRect(0, 0, 800, 800);
                    ctx.strokeRect(e1.clientX - canvas.offsetLeft, e1.clientY - canvas.offsetTop, e2.clientX -
                        e1.clientX, e2.clientY - e1.clientY);
                    drawAll();
                    rect[rectNum].w = e2.clientX - e1.clientX;
                    rect[rectNum].h = e2.clientY - e1.clientY;
                }
                canvas.onmouseup = function () {
                    canvas.onmousemove = '';
                    canvas.onmouseup = '';
                    rectNum++;
                    drawAll();
                }
            } else {
                //creat circle
                circle[circleNum] = new Circle(e1.clientX - canvas.offsetLeft, e1.clientY - canvas.offsetTop, 0)
                canvas.onmousemove = function (e2) {
                    ctx.clearRect(0, 0, 800, 800);
                    ctx.beginPath();
                    ctx.arc(e1.clientX - canvas.offsetLeft, e1.clientY - canvas.offsetTop, Math.abs(e2.clientX -
                        e1.clientX), Math.PI * 2, 0);
                    ctx.stroke();
                    ctx.closePath();
                    drawAll();
                    circle[circleNum].r = Math.abs(e2.clientY - e1.clientY);
                }
                canvas.onmouseup = function () {
                    canvas.onmousemove = '';
                    canvas.onmouseup = '';
                    circleNum++;
                    drawAll();
                }
            }
        }

        function drawAll() {
            ctx.clearRect(0, 0, 800, 800);
            for (i in rect) {
                ctx.strokeRect(rect[i].x, rect[i].y, rect[i].w, rect[i].h);
                ctx.strokeText('矩形'+i,rect[i].x, rect[i].y+10);    
            }
            for (i in circle) {
                ctx.beginPath();
                ctx.arc(circle[i].x, circle[i].y, circle[i].r, Math.PI * 2, 0);
                ctx.stroke();
                ctx.closePath();
                ctx.strokeText('圆'+i,circle[i].x, circle[i].y+20); 
            }
        }
        function clearAll() {
            rect=[];
            circle=[];
            rectNum=0;
            circleNum=0;
            drawAll();
        }
        function Rect(x, y, w, h) {
            this.x = x;
            this.y = y;
            this.w = w;
            this.h = h;
        }

        function Circle(x, y, r) {
            this.x = x;
            this.y = y;
            this.r = r;
        }
        // draw();
    </script>
</body>

</html>